<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Data Analytics App - HTML/CSS/JS</title>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    /* ---------- Global Styles ---------- */
    :root{
      --bg1:#0f172a; /* indigo-900 */
      --bg2:#020617; /* near-black */
      --card:#0b1220;
      --accent:#7c3aed;
      --accent2:#06b6d4;
      --muted:rgba(255,255,255,0.75);
      --glass: rgba(255,255,255,0.04);
      --success: #21c55d;
      --danger: #f43f5e;
      --font-sans: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    html,body{
      height:100%;
      margin:0;
      font-family:var(--font-sans);
      color: #e6eef8;
      background: radial-gradient(1200px 600px at 10% 10%, rgba(124,58,237,0.12), transparent),
                  linear-gradient(180deg,var(--bg1) 0%, var(--bg2) 100%);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    .app {
      display:flex;
      min-height:100vh;
      gap:24px;
    }

    /* ---------- Sidebar ---------- */
    .sidebar {
      width:260px;
      padding:24px;
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      box-shadow: 0 6px 30px rgba(2,6,23,0.6);
      border-right: 1px solid rgba(255,255,255,0.03);
      display:flex;
      flex-direction:column;
      gap:16px;
    }
    .brand { font-size:20px; font-weight:700; letter-spacing:0.4px; color:#fff; }
    .brand-sub { font-size:12px; color:var(--muted); margin-top:4px; }

    .nav {
      margin-top:14px;
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .nav a{
      color:var(--muted);
      text-decoration:none;
      padding:10px 12px;
      border-radius:8px;
      display:block;
      transition:all .15s;
      font-size:14px;
    }
    .nav a.active,
    .nav a:hover{ background: rgba(255,255,255,0.03); color:#fff; transform:translateX(4px); }

    .sidebar-footer { margin-top:auto; font-size:12px; color:var(--muted); }

    /* ---------- Main ---------- */
    .main {
      flex:1;
      padding:28px;
    }

    .header {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      margin-bottom:18px;
    }
    .header .title { font-size:20px; font-weight:700; }
    .header .subtitle { color:var(--muted); font-size:13px; }

    .controls { display:flex; gap:8px; align-items:center; }
    .btn {
      background:linear-gradient(90deg,var(--accent),var(--accent2));
      border:none;color:white;padding:8px 12px;border-radius:8px;font-weight:600;cursor:pointer;
      box-shadow: 0 6px 18px rgba(7,10,30,0.6);
    }
    .btn.ghost { background:transparent;border:1px solid rgba(255,255,255,0.06); color:var(--muted); box-shadow:none; }

    /* ---------- Cards & Grid ---------- */
    .grid {
      display:grid;
      grid-template-columns:repeat(12,1fr);
      gap:18px;
    }
    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:12px;padding:14px;border:1px solid rgba(255,255,255,0.03);
      box-shadow: 0 8px 30px rgba(2,6,23,0.6);
    }
    .col-span-4 { grid-column: span 4; }
    .col-span-6 { grid-column: span 6; }
    .col-span-8 { grid-column: span 8; }
    .col-span-12 { grid-column: span 12; }

    .small-stat { display:flex;flex-direction:column; gap:6px; }
    .small-stat .label { font-size:13px; color:var(--muted); }
    .small-stat .value { font-size:20px; font-weight:700; }

    /* ---------- Table ---------- */
    .table-wrap { overflow:auto; max-height:340px; }
    table { width:100%; border-collapse:collapse; font-size:13px; color: #dbeafe; }
    th,td { padding:10px 8px; text-align:left; border-bottom:1px dashed rgba(255,255,255,0.03); }
    th { color:var(--muted); font-size:12px; font-weight:600; position:sticky; top:0; background:rgba(0,0,0,0.15); }

    /* ---------- Filters & Inputs ---------- */
    .input {
      background:var(--glass); border:1px solid rgba(255,255,255,0.04); padding:8px 10px;border-radius:8px;color:var(--muted);
      outline:none; min-width:180px;
    }

    /* ---------- Footer ---------- */
    footer { margin-top:20px; color:var(--muted); font-size:12px; text-align:center; }

    /* ---------- Responsive ---------- */
    @media(max-width:900px){
      .sidebar { display:none; }
      .grid { grid-template-columns: repeat(6,1fr); }
      .col-span-4{ grid-column: span 6; } .col-span-6{ grid-column: span 6; }
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- Sidebar -->
    <aside class="sidebar" role="navigation">
      <div>
        <div class="brand">DataViz Pro</div>
        <div class="brand-sub">Real-time Analytics — Demo</div>
      </div>
      <nav class="nav">
        <a href="#/" data-route="/" class="active">Home</a>
        <a href="#/dashboards" data-route="/dashboards">Dashboards</a>
        <a href="#/realtime" data-route="/realtime">Realtime Feed</a>
        <a href="#/quality" data-route="/quality">Data Quality</a>
        <a href="#/datasets" data-route="/datasets">Datasets</a>
        <a href="#/settings" data-route="/settings">Settings</a>
      </nav>
      <div class="sidebar-footer">v1.0 • HTML/CSS/JS • No backend • Demo data</div>
    </aside>

    <!-- Main -->
    <main class="main">
      <header class="header">
        <div>
          <div class="title" id="pageTitle">Overview</div>
          <div class="subtitle" id="pageSub">Snapshot of metrics</div>
        </div>
        <div class="controls">
          <input id="globalSearch" class="input" placeholder="Quick search (category)"/>
          <button id="exportBtn" class="btn">Export CSV</button>
          <button id="resetBtn" class="btn ghost">Reset Data</button>
        </div>
      </header>

      <section id="appContent">
        <!-- content injected by JS -->
      </section>

      <footer>© DataViz Pro • Demo • Not for production</footer>
    </main>
  </div>

  <script>
    /**************************************************************************
     * Single-file Data Analytics App
     * - Hash-based simple routing
     * - Simulated dataset with real-time updates
     * - Charts using Chart.js
     * - Data quality checks & CSV export
     **************************************************************************/

    // ---------- Utilities ----------
    const randInt = (min, max) => Math.floor(Math.random()*(max-min+1)) + min;
    const timeFmt = ts => new Date(ts).toLocaleTimeString();
    const now = () => Date.now();

    // Create initial demo dataset
    function genData(count=60){
      const base = Date.now() - count*60000;
      const cats = ['Education','Economy','Crime'];
      const rows = [];
      for(let i=0;i<count;i++){
        rows.push({
          id: i+1,
          ts: base + i*60000,
          metricA: randInt(20,120),
          metricB: randInt(100,900),
          quality: Math.random()>0.96 ? 'MISSING' : 'OK',
          category: cats[i%3]
        });
      }
      return rows;
    }

    let dataset = genData(80);

    // Real-time simulator config
    let streamIntervalMs = 4000;
    let streamTimer = null;

    // ---------- Data Quality ----------
    function qualityChecks(data){
      const total = data.length;
      const missing = data.filter(d=>d.quality!=='OK').length;
      const signatures = new Set(data.map(d => `${d.ts}-${d.metricA}-${d.metricB}`));
      const duplicates = data.length - signatures.size;
      const anomalies = data.filter(d=> d.metricA>110 || d.metricB>880).length;
      return { total, missing, duplicates, anomalies };
    }

    // ---------- CSV Export ----------
    function toCSV(rows){
      if(!rows.length) return '';
      const keys = Object.keys(rows[0]);
      const lines = [keys.join(',')];
      for(const r of rows){
        const vals = keys.map(k => {
          let v = r[k];
          if(typeof v === 'string') v = v.replace(/"/g,'""');
          return `"${v ?? ''}"`;
        });
        lines.push(vals.join(','));
      }
      return lines.join('\n');
    }
    function downloadCSV(text, name='export.csv'){
      const blob = new Blob([text], {type:'text/csv'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = name; document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    }

    // ---------- Simple Router ----------
    function setActiveNav(route){
      document.querySelectorAll('.nav a').forEach(a=>{
        a.classList.toggle('active', a.getAttribute('href') === '#'+route);
      });
    }

    function navigate(){
      const hash = location.hash || '#/';
      const route = hash.replace('#','') || '/';
      renderRoute(route);
      setActiveNav(route);
    }
    window.addEventListener('hashchange', navigate);

    // ---------- Components / Pages ----------
    function renderHome(){
      const q = qualityChecks(dataset);
      return `
        <div class="grid" style="grid-auto-rows:min-content;">
          <div class="card col-span-4 small-stat">
            <div class="label">Total Records</div>
            <div class="value">${q.total}</div>
          </div>
          <div class="card col-span-4 small-stat">
            <div class="label">Anomalies</div>
            <div class="value">${q.anomalies}</div>
          </div>
          <div class="card col-span-4 small-stat">
            <div class="label">Missing / Quality</div>
            <div class="value">${q.missing}</div>
          </div>

          <div class="card col-span-8" id="trendCard">
            <canvas id="trendChart" height="160"></canvas>
          </div>

          <div class="card col-span-4">
            <div style="font-weight:700;margin-bottom:8px">Latest Record</div>
            ${renderLatest()}
          </div>
        </div>
      `;
    }

    function renderLatest(){
      const last = dataset[dataset.length-1] || {};
      return `
        <div style="color:var(--muted);font-size:13px">Time: ${timeFmt(last.ts||now())}</div>
        <div style="font-size:18px;font-weight:700;margin-top:8px">Metric A: ${last.metricA ?? '-'}</div>
        <div style="font-size:18px;font-weight:700;margin-top:4px">Metric B: ${last.metricB ?? '-'}</div>
        <div style="margin-top:10px;font-size:13px;color:var(--muted)">Category: ${last.category ?? '-'}</div>
      `;
    }

    function renderDashboards(){
      const categories = {};
      for(const r of dataset) categories[r.category] = (categories[r.category]||0)+1;
      const pieData = Object.entries(categories).map(([k,v])=>({k,v}));
      return `
        <div class="grid">
          <div class="card col-span-6">
            <div style="font-weight:700;margin-bottom:10px">Category Distribution</div>
            <canvas id="pieChart" height="220"></canvas>
          </div>

          <div class="card col-span-6">
            <div style="font-weight:700;margin-bottom:10px">Recent Values (Metric A)</div>
            <canvas id="barChart" height="220"></canvas>
          </div>

          <div class="card col-span-12" style="margin-top:12px">
            <div style="font-weight:700;margin-bottom:10px">Custom Analytics</div>
            <div style="color:var(--muted);font-size:13px">
              Use filters, windowing, and simple stats. (Demo: mean, median computed on dataset)
            </div>
            <div style="margin-top:10px">${renderBasicStats()}</div>
          </div>
        </div>
      `;
    }

    function renderBasicStats(){
      const arr = dataset.map(d=>d.metricA);
      const mean = (arr.reduce((s,x)=>s+x,0)/arr.length).toFixed(2);
      const sorted = arr.slice().sort((a,b)=>a-b);
      const mid = Math.floor(sorted.length/2);
      const median = sorted.length%2===0 ? ((sorted[mid-1]+sorted[mid])/2).toFixed(2) : sorted[mid].toFixed(2);
      return `<div style="display:flex;gap:18px"><div><div style="color:var(--muted)">Mean (A)</div><div style="font-weight:700">${mean}</div></div>
              <div><div style="color:var(--muted)">Median (A)</div><div style="font-weight:700">${median}</div></div></div>`;
    }

    function renderRealtime(){
      return `
        <div class="grid">
          <div class="card col-span-8">
            <div style="font-weight:700;margin-bottom:10px">Live Metric A</div>
            <canvas id="liveChart" height="200"></canvas>
          </div>

          <div class="card col-span-4">
            <div style="font-weight:700;margin-bottom:8px">Stream Controls</div>
            <div style="display:flex;flex-direction:column;gap:8px">
              <label>Interval (ms)</label>
              <input id="streamRate" class="input" type="number" value="${streamIntervalMs}" />
              <button id="toggleStream" class="btn">Stop Stream</button>
              <div style="color:var(--muted);font-size:13px">Simulated feed — one record every interval.</div>
            </div>
          </div>

          <div class="card col-span-12" style="margin-top:12px">
            <div style="font-weight:700;margin-bottom:10px">Recent Records</div>
            <div class="table-wrap">
              <table id="recentTable">
                <thead><tr><th>Time</th><th>A</th><th>B</th><th>Quality</th><th>Category</th></tr></thead>
                <tbody>${dataset.slice(-20).reverse().map(r=>`<tr><td>${timeFmt(r.ts)}</td><td>${r.metricA}</td><td>${r.metricB}</td><td style="color:${r.quality!=='OK' ? 'var(--danger)' : 'var(--success)'}">${r.quality}</td><td>${r.category}</td></tr>`).join('')}</tbody>
              </table>
            </div>
          </div>
        </div>
      `;
    }

    function renderQuality(){
      const q = qualityChecks(dataset);
      return `
        <div class="grid">
          <div class="card col-span-4 small-stat">
            <div class="label">Total</div><div class="value">${q.total}</div>
          </div>
          <div class="card col-span-4 small-stat">
            <div class="label">Missing</div><div class="value">${q.missing}</div>
          </div>
          <div class="card col-span-4 small-stat">
            <div class="label">Duplicates</div><div class="value">${q.duplicates}</div>
          </div>

          <div class="card col-span-12" style="margin-top:12px">
            <div style="font-weight:700;margin-bottom:10px">Quality Rules</div>
            <ul style="color:var(--muted);font-size:13px">
              <li>Flag records with missing fields (quality != OK).</li>
              <li>Mark anomalies where metricA &gt; 110 or metricB &gt; 880.</li>
              <li>Detect duplicates via signature (timestamp+metrics).</li>
            </ul>
          </div>
        </div>
      `;
    }

    function renderDatasets(){
      return `
        <div class="grid">
          <div class="card col-span-12">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div style="font-weight:700">Datasets</div>
              <div style="display:flex;gap:8px;align-items:center">
                <input id="filterCat" class="input" placeholder="Filter by category"/>
                <button id="exportFiltered" class="btn">Export Filtered</button>
              </div>
            </div>

            <div class="table-wrap" style="margin-top:10px">
              <table id="dataTable">
                <thead><tr><th>ID</th><th>Time</th><th>A</th><th>B</th><th>Category</th><th>Quality</th></tr></thead>
                <tbody>${dataset.map(r=>`<tr><td>${r.id}</td><td>${timeFmt(r.ts)}</td><td>${r.metricA}</td><td>${r.metricB}</td><td>${r.category}</td><td>${r.quality}</td></tr>`).join('')}</tbody>
              </table>
            </div>
          </div>
        </div>
      `;
    }

    function renderSettings(){
      return `
        <div class="grid">
          <div class="card col-span-6">
            <div style="font-weight:700;margin-bottom:8px">Streaming Simulation</div>
            <div style="display:flex;gap:8px;align-items:center">
              <label style="color:var(--muted)">Interval (ms)</label>
              <input id="settingsInterval" class="input" type="number" value="${streamIntervalMs}" />
              <button id="saveSettings" class="btn">Save</button>
            </div>
            <div style="color:var(--muted);margin-top:10px">Adjust the rate for simulated data inflow.</div>
          </div>

          <div class="card col-span-6">
            <div style="font-weight:700;margin-bottom:8px">App Theme</div>
            <div style="color:var(--muted)">This demo uses a gradient dark theme built with CSS variables.</div>
          </div>
        </div>
      `;
    }

    // ---------- Render route ----------
    function renderRoute(route){
      const titleMap = {
        '/':'Overview','/dashboards':'Dashboards','/realtime':'Realtime Feed',
        '/quality':'Data Quality','/datasets':'Datasets','/settings':'Settings'
      };
      document.getElementById('pageTitle').textContent = titleMap[route] || 'Overview';
      document.getElementById('pageSub').textContent = {
        '/':'Snapshot of metrics',
        '/dashboards':'Multi-domain visualizations',
        '/realtime':'Simulated streaming data',
        '/quality':'Checks and reports',
        '/datasets':'Manage and export',
        '/settings':'Configure app parameters'
      }[route] || '';

      const container = document.getElementById('appContent');
      if(route === '/') container.innerHTML = renderHome();
      else if(route === '/dashboards') container.innerHTML = renderDashboards();
      else if(route === '/realtime') container.innerHTML = renderRealtime();
      else if(route === '/quality') container.innerHTML = renderQuality();
      else if(route === '/datasets') container.innerHTML = renderDatasets();
      else if(route === '/settings') container.innerHTML = renderSettings();
      else container.innerHTML = renderHome();

      // after render: initialize charts / controls for each page
      initPage(route);
    }

    // ---------- Charts & Page-specific logic ----------
    let trendChart=null, pieChart=null, barChart=null, liveChart=null;
    function initPage(route){
      // Global search filter hook
      document.getElementById('globalSearch').oninput = (e)=>{
        const q = e.target.value.trim().toLowerCase();
        if(!q){ renderRoute(location.hash.replace('#','')||'/'); return; }
        // simple filter: navigate to datasets view with filter
        location.hash = '#/datasets';
        setTimeout(()=>{ document.getElementById('filterCat').value = q; applyDatasetFilter(); }, 80);
      };

      // Export & Reset controls
      document.getElementById('exportBtn').onclick = ()=> downloadCSV(toCSV(dataset), 'dataset_full.csv');
      document.getElementById('resetBtn').onclick = ()=> { if(confirm('Reset demo data?')){ dataset = genData(80); renderRoute('/'); } };

      if(route === '/'){
        // Trend Chart for last 30 points
        const last30 = dataset.slice(-30);
        const ctx = document.getElementById('trendChart').getContext('2d');
        if(trendChart) trendChart.destroy();
        trendChart = new Chart(ctx, {
          type:'line',
          data:{
            labels: last30.map(d=>timeFmt(d.ts)),
            datasets:[
              { label:'Metric A', data:last30.map(d=>d.metricA), tension:0.3, borderWidth:2, fill:false },
              { label:'Metric B', data:last30.map(d=>d.metricB), tension:0.3, borderWidth:2, fill:false }
            ]
          },
          options:{ plugins:{legend:{labels:{color:'#dbeafe'}}}, scales:{ x:{ ticks:{color:'#c7d2fe'}}, y:{ ticks:{color:'#c7d2fe'} } } }
        });
      }

      if(route === '/dashboards'){
        // Pie chart
        const cats = dataset.reduce((m,d)=>{ m[d.category]=(m[d.category]||0)+1; return m; },{});
        const labels = Object.keys(cats); const values = labels.map(l=>cats[l]);
        const ctx1 = document.getElementById('pieChart').getContext('2d');
        if(pieChart) pieChart.destroy();
        pieChart = new Chart(ctx1, {
          type:'pie',
          data: { labels, datasets:[{ data:values }] },
          options: { plugins:{legend:{labels:{color:'#dbeafe'}}} }
        });

        // Bar chart for recent metricA
        const recent = dataset.slice(-12).map((d,i)=>({i, a:d.metricA}));
        const ctx2 = document.getElementById('barChart').getContext('2d');
        if(barChart) barChart.destroy();
        barChart = new Chart(ctx2, {
          type:'bar',
          data: { labels: recent.map(r=>r.i+1), datasets:[{ label:'Metric A', data: recent.map(r=>r.a) }] },
          options:{ plugins:{legend:{display:false}}, scales:{ x:{ ticks:{color:'#c7d2fe'}}, y:{ ticks:{color:'#c7d2fe'} } } }
        });
      }

      if(route === '/realtime'){
        // Live chart
        const ctx = document.getElementById('liveChart').getContext('2d');
        if(liveChart) liveChart.destroy();
        liveChart = new Chart(ctx, {
          type:'line',
          data:{ labels: dataset.slice(-30).map(d=>timeFmt(d.ts)), datasets:[{ label:'Metric A', data: dataset.slice(-30).map(d=>d.metricA), tension:0.25 }] },
          options:{ animation:false, plugins:{legend:{labels:{color:'#dbeafe'}}}, scales:{ x:{ ticks:{color:'#c7d2fe'}}, y:{ ticks:{color:'#c7d2fe'} } } }
        });

        // Stream controls
        document.getElementById('streamRate').onchange = (e)=> {
          streamIntervalMs = Number(e.target.value) || 3000;
          restartStream();
        };
        document.getElementById('toggleStream').onclick = toggleStream;
      }

      if(route === '/datasets'){
        document.getElementById('filterCat').oninput = applyDatasetFilter;
        document.getElementById('exportFiltered').onclick = ()=>{
          const rows = getFilteredRows();
          downloadCSV(toCSV(rows), 'dataset_filtered.csv');
        };
      }

      if(route === '/settings'){
        document.getElementById('saveSettings').onclick = ()=>{
          const val = Number(document.getElementById('settingsInterval').value) || 4000;
          streamIntervalMs = val; restartStream(); alert('Settings saved (demo).');
        };
      }
    }

    function getFilteredRows(){
      const f = (document.getElementById('filterCat') || {}).value || '';
      if(!f) return dataset;
      return dataset.filter(r=> r.category.toLowerCase().includes(f.toLowerCase()));
    }

    function applyDatasetFilter(){
      const f = document.getElementById('filterCat').value.trim().toLowerCase();
      const tbody = document.querySelector('#dataTable tbody');
      if(!tbody) return;
      tbody.innerHTML = getFilteredRows().map(r=>`<tr><td>${r.id}</td><td>${timeFmt(r.ts)}</td><td>${r.metricA}</td><td>${r.metricB}</td><td>${r.category}</td><td>${r.quality}</td></tr>`).join('');
    }

    // ---------- Streaming (simulated) ----------
    function pushNewRecord(){
      const cats = ['Education','Economy','Crime'];
      const rec = {
        id: (dataset[dataset.length-1]?.id || 0) + 1,
        ts: Date.now(),
        metricA: randInt(10,140),
        metricB: randInt(50,950),
        quality: Math.random()>0.97 ? 'MISSING' : 'OK',
        category: cats[randInt(0,2)]
      };
      dataset.push(rec);
      // keep dataset bounded
      if(dataset.length>2000) dataset = dataset.slice(-2000);

      // update charts if present
      if(trendChart){
        trendChart.data.labels.push(timeFmt(rec.ts));
        trendChart.data.datasets[0].data.push(rec.metricA);
        trendChart.data.datasets[1].data.push(rec.metricB);
        if(trendChart.data.labels.length>30){
          trendChart.data.labels.shift(); trendChart.data.datasets[0].data.shift(); trendChart.data.datasets[1].data.shift();
        }
        trendChart.update('none');
      }
      if(liveChart){
        liveChart.data.labels.push(timeFmt(rec.ts));
        liveChart.data.datasets[0].data.push(rec.metricA);
        if(liveChart.data.labels.length>30){ liveChart.data.labels.shift(); liveChart.data.datasets[0].data.shift(); }
        liveChart.update('none');
      }

      // update recent table if on realtime route
      if(location.hash === '#/realtime'){
        const tbody = document.querySelector('#recentTable tbody');
        if(tbody){
          tbody.innerHTML = dataset.slice(-20).reverse().map(r=>`<tr><td>${timeFmt(r.ts)}</td><td>${r.metricA}</td><td>${r.metricB}</td><td style="color:${r.quality!=='OK' ? 'var(--danger)' : 'var(--success)'}">${r.quality}</td><td>${r.category}</td></tr>`).join('');
        }
      }

      // update datasets page table if visible
      if(location.hash === '#/datasets'){
        applyDatasetFilter();
      }
    }

    function startStream(){
      if(streamTimer) clearInterval(streamTimer);
      streamTimer = setInterval(pushNewRecord, streamIntervalMs);
      const btn = document.getElementById('toggleStream');
      if(btn) btn.textContent = 'Stop Stream';
    }
    function stopStream(){
      if(streamTimer) clearInterval(streamTimer);
      streamTimer = null;
      const btn = document.getElementById('toggleStream');
      if(btn) btn.textContent = 'Start Stream';
    }
    function toggleStream(){
      if(streamTimer) stopStream(); else startStream();
    }
    function restartStream(){ stopStream(); startStream(); }

    // ---------- Initialization ----------
    document.getElementById('exportBtn').addEventListener('click', ()=> downloadCSV(toCSV(dataset), 'dataset_full.csv'));
    document.getElementById('resetBtn').addEventListener('click', ()=> {
      if(confirm('Reset demo dataset?')){
        dataset = genData(80);
        renderRoute('/');
      }
    });

    // start streaming and routing
    startStream();
    navigate();

    // initial navigation listener
    if(!location.hash) location.hash = '#/';

    // Small UX: clicking sidebar links updates active state (handled by hashchange)
    document.querySelectorAll('.nav a').forEach(a=>{
      a.addEventListener('click', ()=> {
        // simple: allow default; hashchange will trigger rendering
      });
    });

    // keep charts updated when outside pages are active: minor refresh
    setInterval(()=> {
      // if on dashboards, refresh tiny charts to reflect new data
      if(location.hash === '#/dashboards') renderRoute('/dashboards');
      if(location.hash === '#/') renderRoute('/');
    }, 20000);

  </script>
</body>
</html>
